<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeaconMarket Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .listing { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { color: red; padding: 10px; background: #fee; border-radius: 4px; }
        .success { color: green; padding: 10px; background: #efe; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üèñÔ∏è BeaconMarket Database Test</h1>
    <div id="status">Loading...</div>
    <div id="listings"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        async function testDatabase() {
            const statusDiv = document.getElementById('status');
            const listingsDiv = document.getElementById('listings');
            
            try {
                // Wait for supabase to load
                if (!window.supabase) {
                    throw new Error('Supabase CDN not loaded');
                }
                
                // Initialize client
                const { createClient } = window.supabase;
                const supabase = createClient(
                    'https://fuddzrlnbrseofguuikp.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1ZGR6cmxuYnJzZW9mZ3V1aWtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDE5NjMsImV4cCI6MjA4NzE3Nzk2M30.pAWnJbzoS-mWOt3LiCVSxb1exm8eT0_rAfT9kSt2XJo'
                );
                
                statusDiv.className = 'success';
                statusDiv.textContent = '‚úÖ Supabase client initialized!';
                
                // Fetch listings
                const { data, error } = await supabase
                    .from('listings')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    throw error;
                }
                
                statusDiv.textContent = `‚úÖ Found ${data.length} listings!`;
                
                // Display listings
                if (data.length === 0) {
                    listingsDiv.innerHTML = '<p>No listings yet. The database is working but empty.</p>';
                } else {
                    listingsDiv.innerHTML = data.map(listing => `
                        <div class="listing">
                            <h3>${listing.title}</h3>
                            <p>${listing.description}</p>
                            <p><strong>R${listing.price} ${listing.price_unit}</strong></p>
                            <p>Contact: ${listing.whatsapp}</p>
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.textContent = `‚ùå Error: ${error.message}`;
                console.error('Full error:', error);
            }
        }
        
        // Wait for DOM and run test
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(testDatabase, 100);
            });
        } else {
            setTimeout(testDatabase, 100);
        }
    </script>
</body>
</html>
