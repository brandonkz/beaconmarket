<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Something - BeaconMarket</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>üèñÔ∏è BeaconMarket</h1>
            </div>
            <nav>
                <a href="index.html">Home</a>
                <a href="listings.html">Browse</a>
                <a href="list-item.html" class="btn-primary active">List Something</a>
            </nav>
        </div>
    </header>

    <section class="form-section">
        <div class="container">
            <h2>Create a Listing</h2>
            <p class="subtitle">List your holiday home, equipment, or service for the Beacon Isle community</p>

            <form id="listing-form" class="listing-form">
                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" required>
                        <option value="">Select a category</option>
                        <option value="holiday-homes">Holiday Home</option>
                        <option value="equipment">Equipment (bikes, kayaks, SUPs, etc.)</option>
                        <option value="services">Service (cleaner, chef, dog walker)</option>
                        <option value="events">Event Gear (easels, tables, party supplies)</option>
                        <option value="parking">Parking & Storage</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="title">Title *</label>
                    <input type="text" id="title" placeholder="e.g., 3-bedroom beach house, Mountain bike rental, Professional cleaner" required>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" rows="6" placeholder="Describe what you're offering, features, availability..." required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="price">Price (R per day/hour/service) *</label>
                        <input type="number" id="price" placeholder="e.g., 500" required>
                    </div>

                    <div class="form-group">
                        <label for="price-unit">Pricing Unit</label>
                        <select id="price-unit">
                            <option value="per night">per night</option>
                            <option value="per day">per day</option>
                            <option value="per hour">per hour</option>
                            <option value="per service">per service</option>
                            <option value="per week">per week</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="your-name">Your Name *</label>
                    <input type="text" id="your-name" placeholder="e.g., Brandon Katz" required>
                </div>

                <div class="form-group">
                    <label for="whatsapp">WhatsApp Number *</label>
                    <input type="tel" id="whatsapp" placeholder="e.g., 0828868631" required>
                    <small>People will contact you via WhatsApp</small>
                </div>

                <div class="form-group">
                    <label for="email">Email (optional)</label>
                    <input type="email" id="email" placeholder="your@email.com">
                </div>

                <div class="form-group">
                    <label for="image-url">Image URL (optional)</label>
                    <input type="url" id="image-url" placeholder="https://example.com/image.jpg">
                    <small>Paste a link to a photo (upload to Imgur, Google Photos, etc.)</small>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="verified-resident" required>
                        I confirm I am a Beacon Isle resident
                    </label>
                </div>

                <button type="submit" class="btn-primary btn-large">Create Listing</button>
            </form>

            <div id="success-message" class="success-message" style="display: none;">
                <h3>‚úÖ Listing Created!</h3>
                <p>Your listing is now live. Share it with the community:</p>
                <button onclick="shareToWhatsApp()" class="btn-primary">Share to WhatsApp Group</button>
                <a href="listings.html" class="btn-secondary">View All Listings</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>BeaconMarket - Beacon Isle Community Marketplace</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://fuddzrlnbrseofguuikp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1ZGR6cmxuYnJzZW9mZ3V1aWtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDE5NjMsImV4cCI6MjA4NzE3Nzk2M30.pAWnJbzoS-mWOt3LiCVSxb1exm8eT0_rAfT9kSt2XJo';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    </script>
    <script src="js/app.js"></script>
    <script>
        let createdListingId = null;

        document.getElementById('listing-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const listing = {
                category: document.getElementById('category').value,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value),
                price_unit: document.getElementById('price-unit').value,
                owner_name: document.getElementById('your-name').value,
                whatsapp: document.getElementById('whatsapp').value.replace(/\D/g, ''),
                email: document.getElementById('email').value || null,
                image_url: document.getElementById('image-url').value || null,
                verified_resident: document.getElementById('verified-resident').checked
            };

            const result = await createListing(listing);
            
            if (result.success) {
                createdListingId = result.data.id;
                document.getElementById('listing-form').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
            } else {
                alert('Error creating listing. Please try again.');
            }
        });

        function shareToWhatsApp() {
            const message = `New listing on BeaconMarket!\n\nCheck it out: https://beaconmarket.co.za/listings.html`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`);
        }
    </script>
</body>
</html>
